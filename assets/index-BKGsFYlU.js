var t=Object.defineProperty,e=(e,i,n)=>((e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n)(e,"symbol"!=typeof i?i+"":i,n);import{r as i}from"./phaser-DJe_tbjO.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver(t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)}).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var n=i(),s=(t=>(t.Idle="Knight-Idle",t.Run="Knight-Run",t.Jump="Knight-Jump",t.Attack="Knight-Attack",t.Attack2="Knight-Attack2",t))(s||{});class a extends n.Physics.Arcade.Sprite{constructor(t,i,n){super(t,i,n,"Knight-Idle",0),e(this,"currentState"),e(this,"stateConfig"),t.add.existing(this),t.physics.add.existing(this),this.currentState="idle",this.stateConfig=new Map([["idle",{animation:"Knight-Idle",canTransitionTo:["running","jumpStart","attacking"],speed:0}],["running",{animation:"Knight-Run",canTransitionTo:["idle","jumpStart","attacking"],speed:75}],["jumpStart",{animation:"Knight-Jump",frame:0,canTransitionTo:["jumpUp"],speed:75,onEnter:()=>{this.setVelocityY(-300),this.setTexture("Knight-Jump",0)}}],["jumpUp",{animation:"Knight-Jump",frame:1,canTransitionTo:["jumpDown","attacking"],speed:75,onEnter:()=>{this.setTexture("Knight-Jump",1)}}],["jumpDown",{animation:"Knight-Jump",frame:2,canTransitionTo:["idle","running","attacking"],speed:75,onEnter:()=>{this.setTexture("Knight-Jump",2)}}],["attacking",{animation:"Knight-Attack",canTransitionTo:["idle","jumpUp","jumpDown"],speed:10,onEnter:()=>{this.once(Phaser.Animations.Events.ANIMATION_COMPLETE,()=>{const t=this.body;t.blocked.down||t.touching.down?this.transitionTo("idle"):t.velocity.y<0?this.transitionTo("jumpUp"):this.transitionTo("jumpDown")})}}]]),this.play("Knight-Idle"),this.setSize(30,40),this.setOffset(40,40),this.body.setDrag(0,1)}static preload(t){const e={frameWidth:120,frameHeight:80};t.load.spritesheet("Knight-Idle","knight/Idle.png",e),t.load.spritesheet("Knight-Run","knight/Run.png",e),t.load.spritesheet("Knight-Jump","knight/Jump.png",e),t.load.spritesheet("Knight-Attack","knight/Attack.png",e),t.load.spritesheet("Knight-Attack2","knight/Attack2.png",e)}static createAnimations(t){const e=t.anims;e.exists("Knight-Idle")||e.create({key:"Knight-Idle",frames:e.generateFrameNumbers("Knight-Idle",{start:0,end:9}),frameRate:10,repeat:-1}),e.exists("Knight-Run")||e.create({key:"Knight-Run",frames:e.generateFrameNumbers("Knight-Run",{start:0,end:9}),frameRate:10,repeat:-1}),e.exists("Knight-Jump")||e.create({key:"Knight-Jump",frames:e.generateFrameNumbers("Knight-Jump",{start:0,end:2}),frameRate:6,repeat:0}),e.exists("Knight-Attack")||e.create({key:"Knight-Attack",frames:e.generateFrameNumbers("Knight-Attack",{start:0,end:3}),frameRate:20}),e.exists("Knight-Attack2")||e.create({key:"Knight-Attack2",frames:e.generateFrameNumbers("Knight-Attack2",{start:0,end:5}),frameRate:20})}flip(t){this.setFlipX(t),t?(this.setSize(30,40),this.setOffset(50,40)):(this.setSize(30,40),this.setOffset(40,40))}transitionTo(t){var e,i;const n=this.stateConfig.get(this.currentState);if(!n||!n.canTransitionTo.includes(t))return!1;null==(e=n.onExit)||e.call(n),this.currentState=t;const s=this.stateConfig.get(t);return this.play(s.animation,!0),null==(i=s.onEnter)||i.call(s),!0}isInState(...t){return t.includes(this.currentState)}getStateSpeed(){var t;return(null==(t=this.stateConfig.get(this.currentState))?void 0:t.speed)??0}update(){const t=this.body,e=t.blocked.down||t.touching.down;this.isInState("jumpStart")?this.transitionTo("jumpUp"):this.isInState("jumpUp")&&t.velocity.y>=0?this.transitionTo("jumpDown"):this.isInState("jumpDown")&&e&&this.transitionTo("idle")}move(t){const e=this.body,i=e.blocked.down||e.touching.down;i&&!this.isInState("attacking")?t.lengthSq()>0?(this.transitionTo("running"),this.setVelocityX(t.x*this.getStateSpeed()),this.flip(t.x<0)):(this.transitionTo("idle"),this.setVelocityX(0)):i||t.lengthSq()>0&&!this.isInState("attacking")&&(this.setVelocityX(75*t.x),this.flip(t.x<0))}jump(){const t=this.body;!t.blocked.down&&!t.touching.down||this.isInState("attacking")||this.transitionTo("jumpStart")}attack(t=!0){if(!this.transitionTo("attacking"))return;const e=t?"Knight-Attack":"Knight-Attack2";this.play(e,!0);const i=this.flipX?-1:1;this.setVelocityX(i*this.getStateSpeed())}}const r="shop-anim";class o extends n.GameObjects.Sprite{static preload(t){t.load.spritesheet(r,"buildings/shop_anim.png",{frameWidth:118,frameHeight:128})}static createAnimations(t){t.anims.exists(r)||t.anims.create({key:r,frames:t.anims.generateFrameNumbers(r,{start:0,end:5}),frameRate:8,repeat:-1})}constructor(t,e,i){super(t,e,i,r,0),t.add.existing(this),this.play(r)}}class h extends n.Scene{constructor(){super("Game"),e(this,"knight"),e(this,"cursors"),e(this,"shop")}preload(){this.load.setPath("assets"),this.load.image("tileset-background1","tilesets/images/background1.png"),this.load.image("tileset-background2","tilesets/images/background2.png"),this.load.image("tileset-background3","tilesets/images/background3.png"),this.load.image("tileset-background4a","tilesets/images/background4a.png"),this.load.image("tileset-mainlev_build","tilesets/images/mainlev_build.png"),this.load.tilemapTiledJSON("level1","level/level1.json"),a.preload(this),o.preload(this)}create(){var t,e;a.createAnimations(this),o.createAnimations(this),this.cameras.main.setRoundPixels(!0);const i=this.make.tilemap({key:"level1"}),n=i.addTilesetImage("background1","tileset-background1"),r=i.addTilesetImage("background2","tileset-background2"),h=i.addTilesetImage("background3","tileset-background3"),c=i.addTilesetImage("background4a","tileset-background4a"),l=i.addTilesetImage("caves","tileset-mainlev_build");i.createLayer(0,n,0,0),i.createLayer(1,r,0,0),i.createLayer(2,h,0,0),i.createLayer(3,c,0,0),this.shop=new o(this,630,336);const d=i.createLayer(4,l,0,0);d.setCollisionBetween(1,2e5,!0),this.knight=new a(this,50,50),this.cursors=null==(t=this.input.keyboard)?void 0:t.createCursorKeys(),null==(e=this.input.keyboard)||e.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE),this.knight.play(s.Idle),this.physics.add.collider(this.knight,d),this.cameras.main.setZoom(4,4),this.cameras.main.setBounds(0,0,1200,480),this.cameras.main.startFollow(this.knight,!0,.1,.1),this.cameras.main.setRoundPixels(!0)}update(){var t,e,i,n,s,a;this.knight.update();const r=new Phaser.Math.Vector2(((null==(e=null==(t=this.cursors)?void 0:t.left)?void 0:e.isDown)?-1:0)+((null==(n=null==(i=this.cursors)?void 0:i.right)?void 0:n.isDown)?1:0),0).normalize();if(this.knight.move(r),Phaser.Input.Keyboard.JustDown(null==(s=this.cursors)?void 0:s.up)&&this.knight.jump(),Phaser.Input.Keyboard.JustDown(null==(a=this.cursors)?void 0:a.space)){const t=0===Phaser.Math.Between(0,1);this.knight.attack(t)}console.log("position",this.knight.x,this.knight.y)}}const c={type:n.AUTO,width:1024,height:768,parent:"game-container",backgroundColor:"#028af8",pixelArt:!0,render:{antialias:!1},physics:{default:"arcade",arcade:{gravity:{x:0,y:600},debug:!0,fixedStep:!0}},scale:{mode:n.Scale.FIT,autoCenter:n.Scale.CENTER_BOTH},scene:[h]};document.addEventListener("DOMContentLoaded",()=>{new n.Game({...c,parent:"game-container"})});
